#!/usr/bin/env bash
#
# Run dotfiles installers with prompts for optional components.

set -e

cd "$(dirname $0)"/..

info () {
  printf "\r  [ \033[00;34m..\033[0m ] $1\n"
}

user () {
  printf "\r  [ \033[0;33m??\033[0m ] $1\n"
}

success () {
  printf "\r\033[2K  [ \033[00;32mOK\033[0m ] $1\n"
}

# Prompt to run an installer
# Usage: run_optional "description" "path/to/install.sh"
run_optional () {
  local name=$1
  local script=$2

  if [ ! -f "$script" ]; then
    return
  fi

  user "Install ${name}? [y/N]"
  read -n 1 answer
  echo ''
  if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
    info "installing ${name}"
    sh -c "$script"
    success "${name} installed"
  else
    success "skipped ${name}"
  fi
}

# Optional components
run_optional "Oh My Zsh"      ./zsh/install.sh
run_optional "Vim plugins"    ./vim/install.sh
run_optional "Tmux plugins (TPM)" ./tmux/install.sh
run_optional "Starship prompt" ./starship/install.sh
run_optional "Rust (rustup)"  ./rust/install.sh
run_optional "Claude Code config" ./claude/install.sh
run_optional "GitHub CLI (gh)" ./gh/install.sh
